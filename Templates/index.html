<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaVision Tank Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
       
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
        }

        .tank-container {
            perspective: 1000px;
            filter: drop-shadow(0 20px 25px rgba(0, 0, 0, 0.1));
        }

        .tank {
            position: relative;
            height: 420px;
            width: 220px;
            background: linear-gradient(to bottom, #f8fafc, #e2e8f0);
            border: 12px solid #ffffff;
            border-radius: 24px;
            overflow: hidden;
            box-shadow:
                inset 0 4px 6px rgba(0, 0, 0, 0.05),
                0 10px 40px rgba(59, 130, 246, 0.15);
        }

        .water {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.9));
            transition: height 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
        }

        .water::before {
            content: "";
            position: absolute;
            top: -5px;
            left: 0;
            right: 0;
            height: 15px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 100% 100% 0 0;
            animation: wave 4s linear infinite;
        }

        .water::after {
            content: "";
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 100% 100% 0 0;
            animation: wave 6s linear infinite reverse;
        }

        .water-bubbles {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: bubble-rise 8s infinite ease-in;
        }

        .water-level-indicator {
            position: absolute;
            right: -45px;
            width: 35px;
            height: 2px;
            background-color: #64748b;
            z-index: 2;
        }

        .water-level-indicator::after {
            content: attr(data-label);
            position: absolute;
            right: 40px;
            top: -8px;
            font-size: 12px;
            color: #64748b;
            font-weight: 500;
        }

        @keyframes wave {
            0% { transform: translateX(0) scaleY(1); }
            50% { transform: translateX(-30%) scaleY(0.95); }
            100% { transform: translateX(0) scaleY(1); }
        }

        @keyframes bubble-rise {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-400px) scale(1.2);
                opacity: 0;
            }
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hover-lift {
            transition: all 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse-glow 2s infinite;
        }

        .progress-container {
            height: 10px;
            background-color: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 1.5s ease-in-out;
        }

        @media (max-width: 768px) {
            .tank {
                height: 320px;
                width: 160px;
            }
           
            .dashboard-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">

        <!-- Simple Level Display -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Tank Status:</h1>
            <h1 id="levelText" class="text-5xl font-bold text-blue-600 mb-4">Loading...</h1>
            <p class="text-gray-600 text-lg">Last Updated: <span id="lastUpdated" class="font-medium">--</span></p>
        </div>

        <div class="flex justify-end space-x-4 mb-4">
            <button id="languageToggle" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition flex items-center">
                <i data-feather="globe" class="mr-2"></i>
                <span>ಕನ್ನಡ</span>
            </button>
            <a href="about.html" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
                <i data-feather="info" class="mr-2"></i>
                <span>About</span>
            </a>
        </div>

        <header class="text-center mb-12">
            <div class="inline-block p-3 bg-gradient-to-r from-blue-500 to-cyan-400 rounded-2xl mb-4 shadow-lg animate-float" style="animation: float 6s ease-in-out infinite;">
                <i data-feather="droplet" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">AquaVision Tank Tracker</h1>
            <p class="text-gray-600 text-lg">Real-time water level monitoring with ESP32 integration</p>
        </header>

        <div id="alertBanner" class="hidden mb-8 p-5 rounded-xl text-white font-medium shadow-lg transition-all duration-300 transform -translate-y-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i data-feather="alert-triangle" class="mr-3"></i>
                    <span id="alertText"></span>
                </div>
                <button id="closeAlert" class="text-white opacity-70 hover:opacity-100">
                    <i data-feather="x"></i>
                </button>
            </div>
        </div>

        <div class="dashboard-container bg-white rounded-2xl shadow-xl p-8 max-w-6xl mx-auto mb-10">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Tank Visualization Column -->
                <div class="lg:col-span-2">
                    <div class="flex flex-col md:flex-row gap-10 items-center">
                        <!-- Tank Visualization -->
                        <div class="tank-container">
                            <div class="tank">
                                <div id="water" class="water"></div>
                                <div class="water-bubbles" id="waterBubbles"></div>
                               
                                <!-- Water level indicators with labels -->
                                <div class="water-level-indicator" style="bottom: 80%;" data-label="80%"></div>
                                <div class="water-level-indicator" style="bottom: 60%;" data-label="60%"></div>
                                <div class="water-level-indicator" style="bottom: 40%;" data-label="40%"></div>
                                <div class="water-level-indicator" style="bottom: 20%;" data-label="20%"></div>
                            </div>
                        </div>
                       
                        <!-- Tank Info Panel -->
                        <div class="flex-1">
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">Water Tank</h2>
                                <p class="text-gray-600">Capacity: 10,000 liters</p>
                                <p class="text-gray-600">Location: Main Building</p>
                            </div>
                           
                            <div class="mb-6">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-700 font-medium">Tank Status</span>
                                    <span id="levelPercentage" class="text-3xl font-bold text-blue-600">--</span>
                                </div>
                                <div class="progress-container">
                                    <div id="progressBar" class="progress-bar bg-gradient-to-r from-blue-500 to-cyan-400"></div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>EMPTY</span>
                                    <span>FULL</span>
                                </div>
                            </div>
                           
                            <div class="flex items-center mb-8">
                                <div id="statusIndicator" class="status-indicator"></div>
                                <div>
                                    <p class="text-sm text-gray-500">Status</p>
                                    <p id="statusText" class="text-xl font-semibold">--</p>
                                </div>
                            </div>
                           
                            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-100">
                                <div class="flex items-center">
                                    <i data-feather="info" class="text-blue-500 mr-3"></i>
                                    <p class="text-sm text-gray-700">
                                        <span id="statusMessage">System monitoring active. Last update: </span>
                                        <span id="lastUpdatedDetailed" class="font-medium">--</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               
                <!-- Stats & Controls Column -->
                <div class="lg:col-span-1">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Tank Analytics</h2>
                   
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-blue-50 to-white p-5 rounded-xl border border-blue-100 hover-lift">
                            <div class="flex items-center mb-3">
                                <div class="p-2 bg-blue-100 rounded-lg mr-3">
                                    <i data-feather="bar-chart-2" class="text-blue-600"></i>
                                </div>
                                <p class="text-sm text-gray-500">Current Status</p>
                            </div>
                            <p id="avgLevel" class="text-3xl font-bold text-gray-800">--</p>
                        </div>
                       
                        <div class="bg-gradient-to-br from-cyan-50 to-white p-5 rounded-xl border border-cyan-100 hover-lift">
                            <div class="flex items-center mb-3">
                                <div class="p-2 bg-cyan-100 rounded-lg mr-3">
                                    <i data-feather="activity" class="text-cyan-600"></i>
                                </div>
                                <p class="text-sm text-gray-500">Last Change</p>
                            </div>
                            <p id="changeRate" class="text-3xl font-bold text-gray-800">--</p>
                        </div>
                    </div>
                   
                    <!-- Last 24h Levels -->
                    <div class="bg-gray-50 p-5 rounded-xl mb-8">
                        <h3 class="font-semibold text-gray-800 mb-4">Status History</h3>
                        <div class="h-32 flex items-end space-x-2" id="levelHistory">
                            <!-- Status bars will be generated here -->
                        </div>
                    </div>
                   
                    <!-- Quick Actions -->
                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-5 rounded-xl">
                        <h3 class="font-semibold mb-4">Quick Actions</h3>
                        <div class="space-y-3">
                            <button class="w-full flex items-center justify-between p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                                <div class="flex items-center">
                                    <i data-feather="refresh-cw" class="mr-3"></i>
                                    <span>Manual Refresh</span>
                                </div>
                                <span id="refreshTimer" class="text-blue-300">3s</span>
                            </button>
                            <button id="simulateBtn" class="w-full flex items-center p-3 bg-gray-700 rounded-lg opacity-50 cursor-not-allowed">
                                <i data-feather="play-circle" class="mr-3"></i>
                                <span>Simulate Data</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
       
        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-500">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center mb-4 md:mb-0">
                    <i data-feather="cpu" class="mr-2"></i>
                    <p>ESP32 Integration Ready • Real-time Monitoring</p>
                </div>
                <div class="flex items-center">
                    <div class="h-2 w-2 rounded-full bg-green-500 animate-pulse mr-2"></div>
                    <p>System Status: <span class="font-medium text-gray-700">Online</span></p>
                </div>
            </div>
        </footer>
    </div>
    <script>
/* ================================
   DOM ELEMENT REFERENCES
================================ */
const waterElement = document.getElementById('water');
const waterBubblesElement = document.getElementById('waterBubbles');
const levelPercentageElement = document.getElementById('levelPercentage');
const progressBarElement = document.getElementById('progressBar');
const statusTextElement = document.getElementById('statusText');
const statusIndicatorElement = document.getElementById('statusIndicator');
const statusMessageElement = document.getElementById('statusMessage');
const lastUpdatedElement = document.getElementById('lastUpdatedDetailed');
const alertBanner = document.getElementById('alertBanner');
const alertText = document.getElementById('alertText');
const closeAlertButton = document.getElementById('closeAlert');
const avgLevelElement = document.getElementById('avgLevel');
const changeRateElement = document.getElementById('changeRate');
const levelHistoryElement = document.getElementById('levelHistory');
const refreshTimerElement = document.getElementById('refreshTimer');
const simulateBtn = document.getElementById('simulateBtn');
const languageToggle = document.getElementById('languageToggle');
const simpleLevelText = document.getElementById('levelText');
const simpleLastUpdated = document.getElementById('lastUpdated');

/* ================================
   CONFIGURATION
================================ */
const updateInterval = 3000; // 3s polling interval from Flask

/* ================================
   DATA STATE
================================ */
let previousStatus = null;
let lastChangeTime = null;
let refreshCountdown = updateInterval / 1000;
let isKannada = false;
let statusHistory = [];

/* ================================
   INITIALIZATION
================================ */
generateStatusHistory();
startRefreshCountdown();
fetchData();
setInterval(fetchData, updateInterval);

/* ================================
   FETCH DATA FROM FLASK
================================ */
async function fetchData() {
    try {
        const response = await fetch("/level");
        const data = await response.json();
        const level = data.level;
        
        // Update both simple and detailed displays
        updateSimpleDisplay(level);
        updateDashboard(level);
        updateStatusHistory(level);
        computeAnalytics(level);
    } catch (err) {
        console.error("Fetch error:", err);
    }
}

/* ================================
   SIMPLE DISPLAY (TOP SECTION)
================================ */
function updateSimpleDisplay(level) {
    const status = level >= 50 ? "FULL" : "EMPTY";
    simpleLevelText.textContent = status;
    simpleLastUpdated.textContent = new Date().toLocaleTimeString();
}

/* ================================
   DASHBOARD UPDATE
================================ */
function updateDashboard(level) {
    // Determine if FULL or EMPTY
    const isFull = level >= 50;
    const displayText = isFull ? (isKannada ? 'ತುಂಬಿದೆ' : 'FULL') : (isKannada ? 'ಖಾಲಿ' : 'EMPTY');
    const statusColor = isFull ? '#34d399' : '#f87171'; // Green for FULL, Red for EMPTY
    
    // Update display
    levelPercentageElement.textContent = displayText;
    simpleLevelText.textContent = displayText;
    progressBarElement.style.width = `${level}%`;
    waterElement.style.height = `${level}%`;

    generateBubbles(level);

    // Update status indicator
    statusIndicatorElement.style.backgroundColor = statusColor;
    statusTextElement.textContent = displayText;
    avgLevelElement.textContent = displayText;

    // Show/hide alerts
    if (!isFull) {
        showAlert(isKannada ? 'ಎಚ್ಚರಿಕೆ: ಟ್ಯಾಂಕ್ ಖಾಲಿ!' : 'Warning: Tank is EMPTY!');
    } else {
        showAlert(isKannada ? 'ಸೂಚನೆ: ಟ್ಯಾಂಕ್ ತುಂಬಿದೆ.' : 'Notice: Tank is FULL.');
    }

    lastUpdatedElement.textContent = new Date().toLocaleTimeString();
    simpleLastUpdated.textContent = new Date().toLocaleTimeString();
}

/* ================================
   ALERT HANDLERS
================================ */
function showAlert(message) {
    alertText.textContent = message;
    alertBanner.classList.remove('hidden');
    alertBanner.style.backgroundColor = '#3b82f6'; // Blue background
}
function hideAlert() {
    alertBanner.classList.add('hidden');
}
closeAlertButton.addEventListener('click', hideAlert);

/* ================================
   BUBBLE GENERATION
================================ */
function generateBubbles(level) {
    waterBubblesElement.innerHTML = "";
    const bubbleCount = Math.floor(level / 10) + 5;
    for (let i = 0; i < bubbleCount; i++) {
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        const size = Math.random() * 10 + 5;
        bubble.style.width = `${size}px`;
        bubble.style.height = `${size}px`;
        bubble.style.left = `${Math.random() * 100}%`;
        bubble.style.animationDuration = `${Math.random() * 3 + 3}s`;
        waterBubblesElement.appendChild(bubble);
    }
}

/* ================================
   ANALYTICS
================================ */
function computeAnalytics(level) {
    const currentStatus = level >= 50 ? "FULL" : "EMPTY";
    
    // Track last change
    if (previousStatus !== null && previousStatus !== currentStatus) {
        lastChangeTime = new Date().toLocaleTimeString();
        changeRateElement.textContent = lastChangeTime;
    }
    
    previousStatus = currentStatus;
}

/* ================================
   STATUS HISTORY BAR GRAPH
================================ */
function generateStatusHistory() {
    levelHistoryElement.innerHTML = "";
    for (let i = 0; i < 12; i++) {
        const bar = document.createElement('div');
        bar.style.height = `${Math.random() > 0.5 ? 80 : 20}%`;
        bar.style.width = "20px";
        bar.style.background = Math.random() > 0.5 ? "#34d399" : "#f87171";
        bar.style.borderRadius = "4px";
        levelHistoryElement.appendChild(bar);
    }
}

function updateStatusHistory(level) {
    statusHistory.push(level >= 50 ? "FULL" : "EMPTY");
    if (statusHistory.length > 12) statusHistory.shift();
    
    // Update the history bars
    levelHistoryElement.innerHTML = "";
    statusHistory.forEach(status => {
        const bar = document.createElement('div');
        bar.style.height = status === "FULL" ? "80%" : "20%";
        bar.style.width = "20px";
        bar.style.background = status === "FULL" ? "#34d399" : "#f87171";
        bar.style.borderRadius = "4px";
        levelHistoryElement.appendChild(bar);
    });
}

/* ================================
   REFRESH COUNTDOWN
================================ */
function startRefreshCountdown() {
    setInterval(() => {
        refreshCountdown--;
        if (refreshCountdown <= 0) refreshCountdown = updateInterval / 1000;
        refreshTimerElement.textContent = `${refreshCountdown}s`;
    }, 1000);
}

/* ================================
   LANGUAGE TOGGLE — KANNADA <-> ENG
================================ */
languageToggle.addEventListener('click', () => {
    isKannada = !isKannada;
    translateLabels();
});

/* ================================
   SIMULATE BUTTON — DISABLED
================================ */
simulateBtn.style.pointerEvents = "none";
simulateBtn.style.opacity = "0.5";
simulateBtn.title = "Disabled in Flask mode";

/* ================================
   LABEL TRANSLATION MAP
================================ */
function translateLabels() {
    // Update all text elements based on language
    const currentLevel = parseInt(waterElement.style.height) || 50;
    const isFull = currentLevel >= 50;
    
    // Update main status displays
    levelPercentageElement.textContent = isFull ? (isKannada ? 'ತುಂಬಿದೆ' : 'FULL') : (isKannada ? 'ಖಾಲಿ' : 'EMPTY');
    simpleLevelText.textContent = isFull ? (isKannada ? 'ತುಂಬಿದೆ' : 'FULL') : (isKannada ? 'ಖಾಲಿ' : 'EMPTY');
    statusTextElement.textContent = isFull ? (isKannada ? 'ತುಂಬಿದೆ' : 'FULL') : (isKannada ? 'ಖಾಲಿ' : 'EMPTY');
    avgLevelElement.textContent = isFull ? (isKannada ? 'ತುಂಬಿದೆ' : 'FULL') : (isKannada ? 'ಖಾಲಿ' : 'EMPTY');
    
    // Update other labels
    document.querySelector('h2.text-2xl.font-bold.text-gray-800.mb-2').textContent =
        isKannada ? 'ನೀರಿನ ಟ್ಯಾಂಕ್' : 'Water Tank';

    document.querySelectorAll('p.text-gray-600')[0].textContent =
        isKannada ? 'ಸಾಮರ್ಥ್ಯ: 10,000 ಲೀಟರ್' : 'Capacity: 10,000 liters';

    document.querySelectorAll('p.text-gray-600')[1].textContent =
        isKannada ? 'ಸ್ಥಳ: ಮುಖ್ಯ ಕಟ್ಟಡ' : 'Location: Main Building';

    document.querySelector('span.text-gray-700.font-medium').textContent =
        isKannada ? 'ಟ್ಯಾಂಕ್ ಸ್ಥಿತಿ' : 'Tank Status';

    document.querySelectorAll('span.text-xs.text-gray-500')[0].textContent =
        isKannada ? 'ಖಾಲಿ' : 'EMPTY';

    document.querySelectorAll('span.text-xs.text-gray-500')[1].textContent =
        isKannada ? 'ತುಂಬಿದೆ' : 'FULL';

    document.querySelector('h2.text-2xl.font-bold.text-gray-800.mb-6').textContent =
        isKannada ? 'ಟ್ಯಾಂಕ್ ವಿಶ್ಲೇಷಣೆ' : 'Tank Analytics';

    document.querySelectorAll('p.text-sm.text-gray-500')[0].textContent =
        isKannada ? 'ಪ್ರಸ್ತುತ ಸ್ಥಿತಿ' : 'Current Status';

    document.querySelectorAll('p.text-sm.text-gray-500')[1].textContent =
        isKannada ? 'ಕೊನೆಯ ಬದಲಾವಣೆ' : 'Last Change';

    document.querySelector('h3.font-semibold.text-gray-800.mb-4').textContent =
        isKannada ? 'ಸ್ಥಿತಿ ಇತಿಹಾಸ' : 'Status History';

    document.querySelector('h3.font-semibold.mb-4').textContent =
        isKannada ? 'ವೇಗದ ಕ್ರಮಗಳು' : 'Quick Actions';

    document.querySelector('span.text-blue-300').textContent = refreshCountdown + "s";

    document.querySelector('footer p').innerHTML =
        isKannada ? 'ESP32 ಸಿದ್ಧ • ನಿಜ ಸಮಯ ಮೇಲ್ವಿಚಾರಣೆ' : 'ESP32 Integration Ready • Real-time Monitoring';

    document.querySelector('footer span.font-medium.text-gray-700').textContent =
        isKannada ? 'ಆನ್‌ಲೈನ್' : 'Online';

    // Update alert if visible
    if (!alertBanner.classList.contains('hidden')) {
        const isFullStatus = currentLevel >= 50;
        alertText.textContent = isFullStatus ? 
            (isKannada ? 'ಸೂಚನೆ: ಟ್ಯಾಂಕ್ ತುಂಬಿದೆ.' : 'Notice: Tank is FULL.') : 
            (isKannada ? 'ಎಚ್ಚರಿಕೆ: ಟ್ಯಾಂಕ್ ಖಾಲಿ!' : 'Warning: Tank is EMPTY!');
    }
}

// Initialize Feather Icons
feather.replace();
    </script>
</body>
</html>
